#!/usr/local/bin/python3
import re
import subprocess
from multiprocessing.pool import ThreadPool
from python.charts import CHARTS


# get base image from chart
def get_chart_images(chart):
    # This is for helm v3
    cmd_list_images = "helm search repo |grep %s |awk '{print $1}'| xargs helm template | grep 'image:'" % chart
    print(cmd_list_images)
    result = subprocess.run(cmd_list_images, shell=True, capture_output=True).stdout.decode('utf-8')
    return result


if __name__ == '__main__':
    # cmd_add_helm_repo = "helm repo add alauda https://admin:t4YSpvPrrFOsjAapawc5@harbor-b.alauda.cn/chartrepo"
    # cmd_add_helm_repo2 = "helm repo add alauda2 http://7DO9QoLtDx1g:2wb4E1iydRj7@alauda-chart-release-new.ace-default.cloud.myalauda.cn/"
    # cmd_update_repo = "helm repo update"

    subprocess.run('helm repo list', shell=True)
    subprocess.run('helm repo up', shell=True, check=True)
    FLAT_CHARTS = [item for sublist in CHARTS for item in sublist]

    pool = ThreadPool(16)
    IMAGES = pool.map(get_chart_images, FLAT_CHARTS)
    pool.close()
    pool.join()
    # print(IMAGES)
    # IMAGES = ['          image: harbor.alauda.cn/ait/courier:v3.0.4\n          image: harbor.alauda.cn/ait/morgans:v3.0.2\n        image: harbor.alauda.cn/ait/lanaya:v3.0.2\n          image: harbor.alauda.cn/ait/mars:v3.0.3\n', '          image: "harbor.alauda.cn/acp/alb2:v3.0.4"\n', '            - image: {{.Image}}\n              image: {{ .GPUManagerImage }}\n              - image: {{ .BusyboxImage }}\n                image: {{ .GPUQuotaAdmissionImage }}\n        - image: {{ .Image }}\n      - image: harbor.alauda.cn/acp/erebus:v3.0.0\n          image: \'harbor.alauda.cn/acp/cyclops:v3.0.15\'\n          image: \'harbor.alauda.cn/acp/cyclops:v3.0.15\'\n        image: harbor.alauda.cn/ait/auth-controller2:v3.0.3\n        image: harbor.alauda.cn/ait/apollo:v3.0.5\n        - image: harbor.alauda.cn/ait/cluster-transformer:v3.0.8\n        image: harbor.alauda.cn/ait/meepo:v3.0.1\n        image: harbor.alauda.cn/tkestack/tke-business-api:v1.3.2\n        image: harbor.alauda.cn/tkestack/tke-business-controller:v1.3.2\n        image: harbor.alauda.cn/tkestack/tke-platform-api:v1.3.2\n      - image: harbor.alauda.cn/tkestack/extra-res:v3.0.6\n        image: harbor.alauda.cn/tkestack/tke-platform-controller:v1.3.2\n        image: harbor.alauda.cn/tkestack/provider-res:v1.18.3-1\n      - image: harbor.alauda.cn/tkestack/extra-res:v3.0.6\n          image: harbor.alauda.cn/ait/underlord:v3.0.11\n          image: harbor.alauda.cn/alauda/alauda-console:v3.0.0\n#          image: index.alauda.cn/alaudak8s/alauda-console:v1.9-b.1\n        image: harbor.alauda.cn/ait/platform-docs:v3.0.8\n            image: harbor.alauda.cn/ait/apollo:v3.0.5\n          image: harbor.alauda.cn/ait/apollo:v3.0.5\n          image: "harbor.alauda.cn/3rdparty/kubectl:1.16.14"\n', '        image: harbor.alauda.cn/acp/tracer:v3.0.0\n        image: harbor.alauda.cn/acp/tracer-stub:v0.0.6\n          image: harbor.alauda.cn/acp/tracer:v3.0.0\n          image: harbor.alauda.cn/acp/tracer-stub:v0.0.6\n        image: harbor.alauda.cn/ait/auth-controller2:v3.0.3\n          image: "harbor.alauda.cn/3rdparty/kubectl:1.16.14"\n          image: "harbor.alauda.cn/3rdparty/kubernetes-event-exporter:0.9"\n          image: harbor.alauda.cn/acp/tracer:v3.0.0\n          image: harbor.alauda.cn/acp/cert-init:v2.0\n          image: harbor.alauda.cn/acp/cyclops:v3.0.15\n', '        image: \'harbor.alauda.cn/acp/cyclops:v3.0.15\'\n      - image: \'harbor.alauda.cn/acp/public-charts:v3.0.10\'\n        image: \'harbor.alauda.cn/3rdparty/chartmuseum:v2.0\'\n        image: \'harbor.alauda.cn/3rdparty/chart-registry:v3.0.2\'\n        image: "harbor.alauda.cn/alauda/alauda-console:v3.0.0"\n          image: "harbor.alauda.cn/acp/icarus:v3.0.34"\n          image: "harbor.alauda.cn/acp/acp-docs:v3.0.7"\n', '        image: harbor.alauda.cn/ait/nevermore:v3.0.4\n', '        - image: harbor-b.alauda.cn/automation/httpd:alpine\n              image: harbor-b.alauda.cn/automation/ares:v3.0.20\n', '        - image: harbor-b.alauda.cn/automation/httpd:alpine\n              image: harbor-b.alauda.cn/automation/artemis:v3.0.2\n', '', "          image: 'harbor.alauda.cn/acp/captain:v3.0.6'\n", '          image: "harbor.alauda.cn/acp/cephfs-provisioner:900bb6c"\n', '          image: "harbor.alauda.cn/3rdparty/cert-manager-cainjector:v0.16.0"\n          image: "harbor.alauda.cn/3rdparty/cert-manager-controller:v0.16.0"\n          image: "harbor.alauda.cn/3rdparty/cert-manager-webhook:v0.16.0"\n', '', '', '          image: harbor.alauda.cn/ait/alauda-fit:v3.0.0\n', '          image: harbor.alauda.cn/ait/alauda-lander:v3.0.0\n', '        image: "harbor.alauda.cn/ait/prometheus-adapter:v0.5.0"\n        image: harbor.alauda.cn/ait/warlock:v3.0.5\n', '          image: "harbor.alauda.cn/acp/cephfs-provisioner:900bb6c"\n          image: "harbor.alauda.cn/acp/csp-provisioner:v3.0.0"\n', '          image: "harbor.alauda.cn/ait/node-exporter:v0.18.0"\n          image: "harbor.alauda.cn/ait/cert-monitor:v3.0.0"\n        image: "harbor.alauda.cn/ait/kube-state-metrics:v1.9.5.1"\n        image: "harbor.alauda.cn/ait/addon-resizer:1.8.8"\n        image: harbor.alauda.cn/ait/grafana-plugins:bdf1fd3\n        image: harbor.alauda.cn/ait/grafana:5.4.4\n', '          image: harbor.alauda.cn/ait/dex:v3.0.0\n', '        image: harbor.alauda.cn/ait/elasticsearch-basic-http:v3.0.4\n        image: harbor.alauda.cn/ait/alaudakibana:v3.0.4\n', '          image: "harbor-b.alauda.cn/automation/qaimages:helloworld"\n', '        image: harbor.alauda.cn/ait/kafka:v3.0.2\n        image: harbor.alauda.cn/ait/zookeeper:v3.0.2\n', '          image: "harbor.alauda.cn/ait/node-exporter:v0.18.0"\n          image: "harbor.alauda.cn/ait/cert-monitor:v3.0.0"\n        image: "harbor.alauda.cn/ait/kube-state-metrics:v1.9.5.1"\n        image: "harbor.alauda.cn/ait/addon-resizer:1.8.8"\n        image: harbor.alauda.cn/ait/grafana-plugins:bdf1fd3\n        image: harbor.alauda.cn/ait/grafana:5.4.4\n', "        image: 'harbor.alauda.cn/kubevirt/virt-operator:v0.30.0'\n", '        image: "harbor.alauda.cn/3rdparty/kubefed:v0.3.0"\n        image: "harbor.alauda.cn/3rdparty/kubefed:v0.3.0"\n          image: "harbor.alauda.cn/3rdparty/kubectl:1.16.14"\n', '          image: "harbor.alauda.cn/acp/nfs-client-provisioner:v3.1.0-k8s1.11"\n', '          image: "harbor.alauda.cn/acp/nfs-provisioner:v2.2.1-k8s1.12"\n', '          image: harbor.alauda.cn/common/nginx-ingress-controller:0.24.1-path-1\n', '          image: harbor.alauda.cn/3rdparty/operator-framework/olm:v3.0.0\n          image: harbor.alauda.cn/3rdparty/operator-framework/olm:v3.0.0\n  image: harbor.alauda.cn/3rdparty/operators-index:v3.0.1-131.gbbbdc3c\n                image: harbor.alauda.cn/3rdparty/operator-framework/olm:v3.0.0\n          image: harbor.alauda.cn/acp/cert-init:v2.0\n', '          image: "harbor.alauda.cn/ait/prometheus-operator:v0.37.0"\n          image: "harbor.alauda.cn/ait/kubectl:1.11.6"\n          image: "harbor.alauda.cn/ait/kubectl:1.11.6"\n', '', '        image: "harbor.alauda.cn/3rdparty/reloader:v0.0.60"\n', '    image: "harbor.alauda.cn/3rdparty/ceph/ceph:v14.2.10"\n', '        image: "harbor.alauda.cn/3rdparty/rook/ceph:v1.3.9"\n        image: "harbor.alauda.cn/3rdparty/rook/ceph:v1.3.9"\n', '          image: harbor.alauda.cn/ait/sentry:v3.0.12\n', '        - image: harbor-b.alauda.cn/automation/httpd:alpine\n              image: harbor-b.alauda.cn/automation/stability:v3.0.13\n', '        image: "harbor.alauda.cn/3rdparty/kubevirt/cdi-operator:v1.22.0"\n        image: "harbor.alauda.cn/3rdparty/kubevirt/virt-operator:v0.32.0"\n', '        image: harbor.alauda.cn/devops/devops-api:v3.0.11\n        image: harbor.alauda.cn/devops/devops-docs:v3.0.6\n        image: harbor.alauda.cn/devops/devops-observer:v3.0.11\n        image: harbor.alauda.cn/devops/devops-apiserver:v3.0.11\n        image: harbor.alauda.cn/devops/devops-apiserver:v3.0.11\n        image: harbor.alauda.cn/devops/pipeline-templates:v3.0.11\n          image: harbor.alauda.cn/devops/diablo-clone-front:v3.0.14\n          image: harbor.alauda.cn/alauda/alauda-console:v3.0.0\n', '        image: harbor.alauda.cn/devops/postgresql:10\n        image: harbor.alauda.cn/devops/gitlab-ce:11.4.0\n        image: harbor.alauda.cn/devops/redis:4.0.9-1\n', '', '              image: harbor.alauda.cn/devops/jnlp-slave:4.0.1-1-jdk11-v3.0.20.20\n              image: harbor.alauda.cn/devops/builder-tools:ubuntu-v3.0.1\n              image: harbor.alauda.cn/devops/builder-java:openjdk8-v3.0.2\n              image: harbor.alauda.cn/devops/builder-go:1.12-ubuntu-v2.13-2-g0cef734\n              image: harbor.alauda.cn/devops/builder-go:1.13-ubuntu-v3.0.0\n              image: harbor.alauda.cn/devops/builder-go:1.14-ubuntu-v3.0.0\n              image: harbor.alauda.cn/devops/builder-nodejs:10-stretch-v3.0.2\n              image: harbor.alauda.cn/devops/builder-nodejs:12-stretch-v3.0.2\n              image: harbor.alauda.cn/devops/builder-python:2.7-v3.0.0\n              image: harbor.alauda.cn/devops/builder-python:3.6-v3.0.0\n              image: harbor.alauda.cn/devops/builder-python:3.7-v3.0.0\n          image: "harbor.alauda.cn/3rdparty/alpine:3.10"\n          image: "harbor.alauda.cn/devops/alauda-jenkins:2.204.5-v3.0.20.20"\n', '', '          image: "harbor.alauda.cn/devops/travelaudience-docker-nexus:3.17.0"\n          image: "harbor.alauda.cn/devops/travelaudience-docker-nexus-proxy:2.5.0"\n', '        image: "harbor.alauda.cn/devops/postgres:10"\n          image: "harbor.alauda.cn/devops/busybox:1.31"\n          image: "harbor.alauda.cn/devops/sonarqube-plugins:7.9.1-community"\n          image: "harbor.alauda.cn/devops/sonarqube:7.9.1-community"\n      image: "harbor.alauda.cn/devops/joosthofman-wget:1.0"\n      image: sonarqube:7.9.1-community\n', '        image: harbor.alauda.cn/devops/testlink:v3.0.0\n', '', '', '', '', '', '', '                image:\n', '          image: "harbor.alauda.cn/asm/flagger:v3.0.0"\n          image: "harbor.alauda.cn/asm/asm-controller:v3.0.2"\n        image: harbor.alauda.cn/asm/jaeger-collector:1.7\n    image: "harbor.alauda.cn/asm/jaeger-collector:1.7"\n    image: "harbor.alauda.cn/asm/jaeger-agent:1.15.1"\n    image: "harbor.alauda.cn/asm/jaeger-query:v3.0.0"\n      image: "harbor.alauda.cn/asm/asm-jaeger-es-index-cleaner:v3.0.0"\n', '          image: "harbor.alauda.cn/asm/flagger:v3.0.0"\n', '        image: harbor.alauda.cn/asm/asm-docs:v3.0.6\n          image: harbor.alauda.cn/asm/hermes:v3.0.1\n          image: harbor.alauda.cn/asm/mephisto:v3.0.5\n          image: harbor.alauda.cn/alauda/alauda-console:v3.0.0\n', '        image: "harbor.alauda.cn/asm/asm-istioctl:v3.0.1"\n        image: "harbor.alauda.cn/asm/asm-istioctl:v3.0.1"\n        image: "harbor.alauda.cn/asm/asm-istioctl:v3.0.1"\n        image: "harbor.alauda.cn/asm/asm-istioctl:v3.0.1"\n', '          image: "harbor.alauda.cn/asm/jaeger-operator:1.15.1"\n', '          image: harbor.alauda.cn/tdsql/cmq:v3.0.0\n', '', '', '    image: \'harbor-b.alauda.cn/redis/ansible:v3.0.2\'\n        image: harbor-b.alauda.cn/redis/controller:dbc1c80\n          image: harbor-b.alauda.cn/redis/exporter:dbc1c80\n          image: harbor-b.alauda.cn/redis/server:dbc1c80\n          image: "harbor-b.alauda.cn/ait/naga_redis:v3.0.3"\n', '          image: "harbor.alauda.cn/acp/cephfs-provisioner:900bb6c"\n          image: "harbor.alauda.cn/acp/csp-provisioner:v3.0.0"\n', "    image: 'harbor.alauda.cn/ti-matrix/install:v2.4.0.1'\n    image: 'harbor.alauda.cn/ti-matrix/ansible-tool:v0.1.1'\n        image: harbor.alauda.cn/ti-matrix/hostdev:v0.1.0\n          image: 'harbor.alauda.cn/ti-matrix/kube-rbac-proxy:v0.4.1'\n          image: 'harbor.alauda.cn/ti-matrix/timatrix-controller:v2.14.0'\n", '', '          image: harbor.alauda.cn/tsf/tsf-adapter:v3.0.0\n', '        image:  harbor.alauda.cn/coding/artifacts-api-server:2.6.7.98d87b\n        image: harbor.alauda.cn/coding/artifacts-auth-server:2.6.7-alauda.6ea698\n        image: harbor.alauda.cn/coding/artifacts-composer-registry:2.5.ba3c61\n        image: harbor.alauda.cn/coding/artifacts-conan-registry:2.5.ba3c61\n        image: harbor.alauda.cn/coding/artifacts-docker-registry:2.5.9b4049\n        image:  harbor.alauda.cn/coding/artifacts-frontend:2.6.7-alauda.6ea698\n        image: harbor.alauda.cn/coding/artifacts-generic-registry:2.5.ba3c61\n        image: harbor.alauda.cn/coding/artifacts-helm-registry:2.5.ba3c61\n        image: harbor.alauda.cn/coding/artifacts-maven-registry:2.5.ba3c61\n        image: harbor.alauda.cn/coding/artifacts-npm-registry:2.5.ba3c61\n        image: harbor.alauda.cn/coding/artifacts-nuget-registry:2.6.7.98d87b\n        image: harbor.alauda.cn/coding/artifacts-pypi-registry:2.5.ba3c61\n        image: harbor.alauda.cn/coding/artifacts-storage-manager:2.5.ba3c61\n', '  coding-net-public-image: "coding-static-bucket-public"\n  coding-net-public-image: "coding-static-bucket-public"\n          image: harbor.alauda.cn/coding/nginx:stable-alpine \n          image: harbor.alauda.cn/coding/influxdb-relay:0.20161114.0-scratch-r6\n          image: harbor.alauda.cn/coding/pgpool:4.1.1-debian-10-r66\n        image: harbor.alauda.cn/coding/haproxy:alpine\n        image: harbor.alauda.cn/coding/e-admin:2.6.5.1.233c64\n        image: harbor.alauda.cn/coding/e-coding:2.6.7-alauda.0cc85\n         image: harbor.alauda.cn/coding/e-org-unit:v28\n        image: harbor.alauda.cn/coding/e-scheduler:20200111.1\n        image: harbor.alauda.cn/coding/e-session:20200111.1\n        image: harbor.alauda.cn/coding/e-statistic:20200111.1\n        image: harbor.alauda.cn/coding/email:20200111.1\n        image: harbor.alauda.cn/coding/enterprise-front:2.6.7-alauda.d24a91\n        image: "harbor.alauda.cn/coding/repo-auth-server:2.6.7-alauda.cdd292"\n        image: harbor.alauda.cn/coding/md2html:20200111.1\n        image: harbor.alauda.cn/coding/message:20200111.1\n        image: harbor.alauda.cn/coding/pinyin:20200111.1\n        image: harbor.alauda.cn/coding/git-file-server:2.5.643d69\n          image: harbor.alauda.cn/coding/git-file-server:2.5.643d69\n          image: harbor.alauda.cn/coding/git-server:2.5.bfa160\n          image: harbor.alauda.cn/coding/webhook-listener:2.5.0d5494\n          image: "harbor.alauda.cn/coding/coding-grpc-gateway:20191220.1"\n          image: harbor.alauda.cn/coding/coding-kong:20191118.1\n        image: harbor.alauda.cn/coding/e-tengine:20190630.2\n          image: harbor.alauda.cn/coding/etcd:3.3.15\n          image: harbor.alauda.cn/coding/influxdb:1.8.0-debian-10-r11\n          image: harbor.alauda.cn/coding/mariadb-galera:10.4.12-debian-10-r88\n          image: harbor.alauda.cn/coding/minio:2020.5.16-debian-10-r0\n          image: harbor.alauda.cn/coding/mongodb:4.2.8-debian-10-r26\n          image: harbor.alauda.cn/coding/postgresql-repmgr:11.7.0-debian-10-r87\n          image: harbor.alauda.cn/coding/rabbitmq:3.8.3-debian-10-r79\n          image: harbor.alauda.cn/coding/redis:6.0.1-debian-10-r1\n          image: "harbor.alauda.cn/coding/redis-sentinel:6.0.1-debian-10-r0"\n          image: harbor.alauda.cn/coding/redis-exporter:1.6.0-debian-10-r2\n          image: harbor.alauda.cn/coding/redis:6.0.1-debian-10-r1\n          image: harbor.alauda.cn/coding/redis-sentinel:6.0.1-debian-10-r0\n          image: harbor.alauda.cn/coding/redis-exporter:1.6.0-debian-10-r2\n          image: harbor.alauda.cn/coding/git-backup:2.5.bfa160\n          image: harbor.alauda.cn/coding/git-file-server:2.5.643d69\n          image: harbor.alauda.cn/coding/git-file-server:2.5.643d69\n          image: harbor.alauda.cn/coding/git-scheduler:2.5.643d69\n          image: harbor.alauda.cn/coding/svn-rpc-server:2.5.643d69\n          image: harbor.alauda.cn/coding/git-file-server:2.5.643d69\n          image: harbor.alauda.cn/coding/repo-manager:0d549476051bd11d2558cb616f6df8fb00b442e0\n          image: harbor.alauda.cn/coding/svn-manager:2.5.0d5494\n          image: harbor.alauda.cn/coding/svn-server:2.5.0d5494\n        image: harbor.alauda.cn/coding/ssdb:20191105.1\n        image: harbor.alauda.cn/coding/thumbor:6.7.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n      - image: "harbor.alauda.cn/coding/alpine-curl:1.0.0"\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/alpine:3.12.0\n        - image: harbor.alauda.cn/coding/minio-init:2.5.3a2ce1\n        - image: harbor.alauda.cn/coding/mysql-init:2.6.7-alauda.cc1fd3\n      image: "dduportal/bats:0.4.0"\n      image: harbor.alauda.cn/coding/mariadb-galera:10.4.12-debian-10-r88\n', '          image: "harbor.alauda.cn/coding/cd-scheduler:2.0191227.1"\n          image: "harbor.alauda.cn/coding/cd-frontend:f5ed252e54560bc793d0a76a7c59d4ca1509e812"\n          image: "harbor.alauda.cn/coding/cd-scheduler:2.0191227.1"\n          image: "harbor.alauda.cn/coding/cd-scheduler:2.0191227.1"\n          image: "harbor.alauda.cn/coding/executor-adaptor-apiserver:2.0191227.1"\n          image: "harbor.alauda.cn/coding/executor-clouddriver:2.0191227.1"\n          image: "harbor.alauda.cn/coding/cd-qflow:2.0191219.1"\n          image: "harbor.alauda.cn/coding/cd-scheduler:2.0191227.1"\n', '  ci.jenkins.image: "harbor.alauda.cn/coding/jenkins-cci:kubernetes-v1"\n          image: harbor.alauda.cn/coding/codedog-analysis-worker:v2.5\n          image: harbor.alauda.cn/coding/codedog-analysis:20200905.1\n          image: harbor.alauda.cn/coding/codedog-client:2.5.1.7eea49\n          image: harbor.alauda.cn/coding/dsnq-ftp:2.5.5bdf0e\n          image: harbor.alauda.cn/coding/codedog-main:2.6.6.1.795d95\n          image: harbor.alauda.cn/coding/codedog-main:2.6.6.1.795d95\n          image: harbor.alauda.cn/coding/codedog-nginx:1.13\n          image: harbor.alauda.cn/coding/codedog-scmproxy:v2.5\n          image: harbor.alauda.cn/coding/qtap-apigw:2.5.dc2aa9\n          image: harbor.alauda.cn/coding/qtap-artifact:2.5.e43add\n          image: harbor.alauda.cn/coding/qtap-coding:2.5.2bb9ac\n          image: harbor.alauda.cn/coding/qtap-dmem:2.5.da23cc\n          image: harbor.alauda.cn/coding/qtap-drun:2.5.e5d965\n          image: harbor.alauda.cn/coding/qtap-drun:2.5.e5d965\n          image: harbor.alauda.cn/coding/qtap-drun:2.5.e5d965\n          image: harbor.alauda.cn/coding/qtap-drun:2.5.e5d965\n          image: harbor.alauda.cn/coding/qtap-drun:2.5.e5d965\n          image: harbor.alauda.cn/coding/dsnq-ftp:2.5.5bdf0e\n        image: harbor.alauda.cn/coding/qtap-frontend:2.6.6.1.5f8eeb\n          image: harbor.alauda.cn/coding/qtap-meta:2.5.63d9b8\n          image: harbor.alauda.cn/coding/qtap-notify:2.5.c53456\n          image: harbor.alauda.cn/coding/qtap-project:2.5.00af30\n          image: harbor.alauda.cn/coding/qtap-pypi:2.5.e346c4\n          image: harbor.alauda.cn/coding/qtap-report:2.5.505ac1\n          image: harbor.alauda.cn/coding/qtap-report:2.5.505ac1\n          image: harbor.alauda.cn/coding/qtap-report:2.5.505ac1\n          image: harbor.alauda.cn/coding/qtap-resmgr:2.5.77af4d\n          image: harbor.alauda.cn/coding/qtap-resmgr:2.5.77af4d\n          image: harbor.alauda.cn/coding/qtap-resmgr:2.5.77af4d\n          image: harbor.alauda.cn/coding/qtap-task:2.5.0e0408\n          image: harbor.alauda.cn/coding/qtap-task:2.5.0e0408\n          image: harbor.alauda.cn/coding/qtap-task:2.5.0e0408\n          image: harbor.alauda.cn/coding/qtap-task:2.5.0e0408\n          image: harbor.alauda.cn/coding/qtap-testcase:2.5.002ad3\n          image: harbor.alauda.cn/coding/qtap-testcase:2.5.002ad3\n          image: harbor.alauda.cn/coding/qtap-testcase:2.5.002ad3\n        image: harbor.alauda.cn/coding/cci:2.0200111.1\n        image: "harbor.alauda.cn/coding/ci-frontend:2.6.7-alauda.8070eb"\n        image: harbor.alauda.cn/coding/ci-manager:2.0200111.1\n          image: harbor.alauda.cn/coding/qtap-nodemgr:2.5.ff248e\n        - image: harbor.alauda.cn/coding/qtap-plugin:2.5.b0850b\n', '          image: harbor.alauda.cn/coding/coding-operator:v3.0.4\n', '        image: harbor.alauda.cn/coding/coding-testing-commands:2.6.5.2.28051d\n        image: harbor.alauda.cn/coding/coding-testing-echo-server:2.5.41e455\n        image: harbor.alauda.cn/coding/coding-testing-front:2.6.5.2.0322d9\n        image: harbor.alauda.cn/coding/coding-testing:2.6.4.f30323\n', '']
    IMAGES = [IMAGE.replace(" ", "").split("\n") for IMAGE in IMAGES]
    FLAT_IMAGES = [item for sublist in IMAGES for item in sublist]
    print(FLAT_IMAGES)
    images = set()
    for image in FLAT_IMAGES:
        if re.compile(".*harbor.alauda.cn.*").match(image):
            # print(True, image.replace('image:', '').replace('"', '').replace("'", ""))
            images.add(image.replace('image:', '').replace('"', '').replace("'", ""))
    print(len(images))

    with open('images.txt', 'w') as f:
        for image in images:
            f.writelines("%s\n" % image)

